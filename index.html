<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      body {
        background-color: #21262d;
        padding: 30px;
        font-family: "Courier New", Courier, monospace;
        font-size: 16px;
      }

      .defaultElements {
        width: 400px;
        display: flex;
        flex-direction: column;
        height: 200px;
        justify-content: space-between;
        color: antiquewhite;
      }

      p {
        color: antiquewhite;
        width: 70%;
      }
    </style>

    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learn Shadow DOM</title>
  </head>
  <body>
    <div class="defaultElements">
      <textarea placeholder="this text is in shadow DOM"></textarea>
      <input type="file" />

      <select>
        <option value="B">A</option>
        <option value="B">B</option>
      </select>
    </div>

    <p>
      In this insightful piece of writing, the writer describes Edgar Allan
      Poe’s visionary ideas about the universe as detailed in his Prose poem
      “Eureka”. Eureka begins with a dedication to the German naturalist
      Alexander von Humboldt. Humboldt’s masterful collection of the Kosmos had
      directly inspired Eureka. The writer says that Poe saw the Universe as a
      central hub – the visible bulge and spiral of the Milky Way – surrounded
      by a seemingly endless sea of scattered stars and gaseous nebula. Have you
      ever wondered why is the sky dark at night? I am sure you would have and
      if you were curious enough you would have also read many works attempting
      to answer this. So here you would receive another solution to this
      perplexing question as one of the great triumphs of Eureka, was Poe’s
      solution to a perplexing scientific riddle known as Olbers’s paradox ” Why
      is the sky dark at night?”. Eureka, says the writer offers a snapshot of
      the thinking of the age about how the world and the Universe developed.
      Definitely an interesting read!
    </p>

    <meaning-ful></meaning-ful>
  </body>

  <script>
    // Define web component for meaningful

    class Meaningful extends HTMLElement {
      constructor() {
        super();

        const shadowRoot = this.attachShadow({ mode: "open" });

        // define shadow DOM and styles

        shadowRoot.innerHTML = `
        <style>
            .super{
                display:flex;
                justify-content:center;
            }

            .main{
                width:350px;
                min-height:200px;
                background:lightgreen;
                border-radius:40px;
                display:flex;
                flex-direction:column;
                position:absolute;
                z-index:999;
                opacity:0;
                padding:20px;
            }

            </style>

            <div class="super">
                <div class="main" id="meaningful">
                    </div>
                </div>
        `;
        // define selection

        // show the banner if word is selected and handle visibility

        // get the rects of the selected word
      }

      getWordMeaning = async (word) => {
        this.shadowRoot.getElementById("meaningful").innerHTML =
          "<h6>Loading</h6>";
        fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`)
          .then((response) => {
            return response.json();
          })
          .then((data) => {
            console.log(data);

            this.shadowRoot.getElementById("meaningful").innerHTML = `
              <b id="word">${data[0]?.word || ""}</b>
              <i id="pronounce">${data[0]?.phonetic || ""}</i>
              <p id="meaning">${
                data[0]?.meanings[0]?.definitions[0]?.definition ||
                "No Definition Available"
              }</p>
                `;
          })
          .catch(() => {
            // handle error
          });
      };

      handleSlectionChange = (event) => {
        const selection = window.getSelection();

        // get the selected word
        const selectedWord = selection?.focusNode?.textContent?.slice(
          selection.anchorOffset,
          selection.focusOffset
        );

        const shadowElement = this.shadowRoot.getElementById("meaningful");
        // show the banner if word is selected and handle visibility

        if (selectedWord?.length) {
          // get the rects of the selected word
          this.getWordMeaning(selectedWord);
          const selectionRect = selection.getRangeAt(0).getBoundingClientRect();

          shadowElement.style.visibility = "visible";
          shadowElement.style.opacity = "1";
          shadowElement.style.top = `${
            selectionRect.top + window.scrollY + 30
          }px`;

          if (selectionRect.right < window.outerWidth - 300)
            shadowEle.style.left = `${selectionRect.left}px`;
        } else {
          shadowElement.style.visibility = "hidden";
          shadowElement.style.opacity = "0";
        }
      };

      connectedCallback() {
        // add listener

        document.addEventListener("selectionchange", this.handleSlectionChange);
      }

      disconnectedCallback() {}
    }

    customElements.define("meaning-ful", Meaningful);
  </script>
</html>
